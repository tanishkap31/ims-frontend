<!DOCTYPE html>
<html>
<head>
    <title>Reset Password</title>
    <link rel="stylesheet" href="style-reset.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>

<div class="glass-card">
    <h2>Reset Password 🔐</h2>
    <p class="sub">Enter your role, new password, and confirm to complete your reset</p>

    <form id="resetForm">

        <div class="input-box">
            <select id="role" required>
                <option value="">Select Role</option>
                <option value="user">User</option>
                <option value="admin">Admin</option>
            </select>
        </div>

        <div class="input-box">
            <input type="password" id="newPass" placeholder="New Password" required>
        </div>

        <div class="input-box">
            <input type="password" id="confirmPass" placeholder="Confirm Password" required>
        </div>

        <button type="submit" class="reset-btn">Reset Password</button>

        <p class="back"><a href="login.html">Back to Login</a></p>

    </form>
</div>

<script>
    // Extract token from URL
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get("token");

    if (!token) {
        alert("Invalid or missing token!");
    }

    document.getElementById("resetForm").addEventListener("submit", async function(e){
        e.preventDefault();

        let role = document.getElementById("role").value;
        let newPass = document.getElementById("newPass").value;
        let confirmPass = document.getElementById("confirmPass").value;

        if(newPass !== confirmPass){
            alert("Passwords do not match!");
            return;
        }

        let req = await fetch("http://localhost:8080/reset", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({
                token: token,
                role: role,
                newPassword: newPass
            })
        });

        let res = await req.text();
        alert(res);

        if(res.includes("Successful")){
            window.location.href = "login.html";
        }
    });
</script>

</body>
</html>
